# å¤šç”¨æˆ·Agentå¼€å‘å’Œä½¿ç”¨ç³»ç»Ÿ - ç³»ç»Ÿè®¾è®¡

## 1. æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

åŸºäºç°æœ‰MaaSç³»ç»Ÿçš„DDDæ¶æ„ï¼Œé‡‡ç”¨å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Web Frontend                    â”‚
â”‚              (Vue 3 + Element Plus)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                API Gateway                      â”‚
â”‚            (FastAPI + Middleware)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent    â”‚ AgentStore â”‚   Chat   â”‚ Integration â”‚
â”‚  Module   â”‚   Module   â”‚  Module  â”‚   Module    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Shared Infrastructure Layer             â”‚
â”‚       (Database, Cache, Auth, Logging)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          External Services                      â”‚
â”‚    (LLM APIs, MCP Tools, Vector DB, Search)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆé€‰æ‹©

**åç«¯æŠ€æœ¯æ ˆï¼š**
- **ç¼–ç¨‹è¯­è¨€**: Python 3.11+
- **Webæ¡†æ¶**: FastAPI (ç°æœ‰æ¡†æ¶)
- **ORMæ¡†æ¶**: SQLAlchemy 2.0 (ç°æœ‰)
- **æ•°æ®åº“**: PostgreSQL (ä¸»æ•°æ®åº“)
- **ç¼“å­˜**: Redis (ä¼šè¯å­˜å‚¨å’Œç¼“å­˜)
- **å‘é‡æ•°æ®åº“**: Milvus (RAGçŸ¥è¯†ç³»ç»Ÿ)
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery (å¼‚æ­¥ä»»åŠ¡å¤„ç†)
- **åŒ…ç®¡ç†**: uv (ç°æœ‰)

**å‰ç«¯æŠ€æœ¯æ ˆï¼š**
- **æ¡†æ¶**: Vue 3 + Composition API
- **UIåº“**: Element Plus
- **è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: Vite (rolldown-vite)
- **è·¯ç”±**: Vue Router 4
- **çŠ¶æ€ç®¡ç†**: Pinia 3

**AIä¸å·¥ä½œæµæŠ€æœ¯æ ˆï¼š**
- **å·¥ä½œæµå¼•æ“**: LangGraph (çŠ¶æ€ç®¡ç†å’Œå·¥ä½œæµç¼–æ’)
- **AIæ¡†æ¶**: LangChain (æ¨¡å‹æŠ½è±¡å’Œå·¥å…·é“¾)
- **å·¥å…·åè®®**: FastMCP (Client-Serveræ¶æ„)
- **æµå¼é€šä¿¡**: HTTP Streaming (æ›¿ä»£SSE)

## 2. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 2.1 Agentæ¨¡å— (src/agent/)

åŸºäºDDDåˆ†å±‚ç»“æ„è®¾è®¡ï¼š

```
src/agent/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ agent.py          # Agentèšåˆæ ¹
â”‚   â”‚   â”œâ”€â”€ template.py       # Agentæ¨¡æ¿å®ä½“
â”‚   â”‚   â””â”€â”€ workflow.py       # LangGraphå·¥ä½œæµ
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ agent_repository.py
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ agent_service.py
â”‚       â””â”€â”€ version_service.py
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ agent_service.py        # Agentåº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ agentstore_service.py   # AgentStoreæœåŠ¡
â”‚   â”œâ”€â”€ chat_service.py         # å¯¹è¯æœåŠ¡
â”‚   â”œâ”€â”€ development_service.py  # å¼€å‘ç¯å¢ƒæœåŠ¡
â”‚   â””â”€â”€ schemas.py
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repositories.py      # Agentä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ sandbox.py           # ä»£ç æ‰§è¡Œæ²™ç®±
â”‚   â””â”€â”€ storage.py           # Agentä»£ç å­˜å‚¨
â””â”€â”€ interface/
    â”œâ”€â”€ agent_controller.py       # Agent APIæ§åˆ¶å™¨
    â”œâ”€â”€ agentstore_controllerpy   # AgentStore APIæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ chat_scontroller.py       # å¯¹è¯ APIæ§åˆ¶å™¨
```

**æ ¸å¿ƒé¢†åŸŸæ¨¡å‹ï¼š**

```python
class Agent(AggregateRoot):
    """Agentèšåˆæ ¹"""
    def __init__(self, id: UUID, name: str, description: str, 
                 developer_id: UUID, workflow: LangGraphWorkflow):
        self.id = id
        self.name = name
        self.description = description
        self.developer_id = developer_id
        self.workflow = workflow
        self.version = "1.0.0"
        self.status = AgentStatus.DRAFT
        self.service_dependencies = {}
        self.tool_dependencies = []
        self.rag_enabled = False
```

### 2.2 AgentStoreæ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š**

```python
class AgentStoreService:
    """AgentStoreåº”ç”¨æœåŠ¡"""

    async def publish_agent(self, agent_id: UUID, developer_id: UUID):
        """å‘å¸ƒAgentåˆ°å•†åº—"""

    async def search_agents(self, query: str, filters: dict):
        """æœç´¢Agent"""

    async def get_recommendations(self, user_id: UUID):
        """è·å–æ¨èAgent"""
```

### 2.3 Chatæ¨¡å—

åŸºäºç°æœ‰chat_controlleræ‰©å±•ï¼š

```python
class ChatService:
    """å¯¹è¯æœåŠ¡"""

    async def create_chat(self, user_id: UUID, agent_id: UUID):
        """åˆ›å»ºæ–°å¯¹è¯ï¼ˆè‡ªåŠ¨é”å®šAgentç‰ˆæœ¬ï¼‰"""

    async def send_message(self, chat_id: UUID, message: str):
        """å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤"""

    async def get_chat_history(self, chat_id: UUID):
        """è·å–å¯¹è¯å†å²"""
```

**LangGraphé›†æˆï¼š**

```python
class AgentExecutionGraph:
    """Agentæ‰§è¡Œå›¾"""

    def __init__(self, agent_version: AgentVersion):
        self.graph = StateGraph(ChatState)
        self._build_graph(agent_version.workflow_definition)

    async def execute(self, message: str, context: dict):
        """æ‰§è¡ŒAgentå·¥ä½œæµ"""
        return await self.graph.ainvoke({
            "messages": [message],
            "context": context
        })
```

### 2.4 Integrationæ¨¡å— (src/integration/)

**MCPå·¥å…·é›†æˆï¼ˆFastMCP Client-Serveræ¶æ„ï¼‰ï¼š**

```python
# å®¢æˆ·ç«¯ï¼šMCPå·¥å…·CRUDç®¡ç†
class IntegratedMCPToolManager:
    """é›†æˆçš„MCPå·¥å…·ç®¡ç†å™¨ - æ¡¥æ¥Agentç³»ç»Ÿä¸MCPæœåŠ¡å™¨"""
    
    def __init__(self, mcp_server_url: str):
        self.client = MCPStreamClient(mcp_server_url)
    
    async def prepare_agent_tools(self, agent_version_id: str, tool_dependencies: List[str]):
        """ä¸ºAgentå‡†å¤‡å·¥å…·ç¯å¢ƒã€åˆ›å»ºTopicæœåŠ¡å™¨"""
        
    async def call_agent_tool(self, agent_version_id: str, tool_name: str, parameters: dict):
        """è°ƒç”¨Agentå·¥å…·çš„ç»Ÿä¸€æ¥å£"""
        
    async def call_agent_tool_stream(self, agent_version_id: str, tool_name: str, parameters: dict):
        """æµå¼è°ƒç”¨Agentå·¥å…·"""

```


## 3. æ•°æ®åº“è®¾è®¡è¯¦è¿°

### 3.1 Agentç›¸å…³è¡¨è®¾è®¡

#### 3.1.1 Agentåˆ†ç±»è¡¨
```sql
CREATE TABLE agent_categories (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    parent_id UUID REFERENCES agent_categories(id),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.1.2 Agentè¡¨ï¼ˆåŸºäºç‰ˆæœ¬è®¾è®¡ï¼‰
```sql
CREATE TABLE agents (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    developer_id UUID REFERENCES users(id),
    category_id UUID REFERENCES agent_categories(id),
    tags TEXT[], -- Agentæ ‡ç­¾æ•°ç»„
    status VARCHAR(50) DEFAULT 'draft', -- 'draft', 'published', 'archived'
    download_count INTEGER DEFAULT 0,
    average_rating DECIMAL(3,2),
    latest_version VARCHAR(50),
    published_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.1.3 Agentç‰ˆæœ¬è¡¨ï¼ˆæ”¯æŒMulti-Agentå·¥ä½œæµå’Œæ¨¡æ¿åŒ–ï¼‰
```sql
CREATE TABLE agent_versions (
    id UUID PRIMARY KEY,
    agent_id UUID REFERENCES agents(id) ON DELETE CASCADE,
    version VARCHAR(50) NOT NULL,
    
    -- ğŸš€ åŸºäºèŠ‚ç‚¹çš„æœåŠ¡ä¾èµ–é…ç½®ï¼ˆæ”¯æŒMulti-Agentå·¥ä½œæµï¼‰
    service_dependencies JSONB NOT NULL DEFAULT '{}', 
    -- æ ¼å¼ï¼š{"node_name": {"service_type": config_id, ...}, ...}
    
    model_params_override JSONB,        -- å¯é€‰çš„æ¨¡å‹å‚æ•°è¦†ç›–
    
    -- ğŸ¯ å·¥ä½œæµå®šä¹‰æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰
    workflow_definition JSONB,          -- è‡ªå®šä¹‰å·¥ä½œæµé€»è¾‘ï¼ˆå†…è”æ–¹å¼ï¼‰
    workflow_template_id UUID REFERENCES workflow_templates(id), -- åŸºäºæ¨¡æ¿æ–¹å¼
    template_parameters JSONB,          -- æ¨¡æ¿å‚æ•°å®ä¾‹åŒ–å€¼
    
    system_prompt TEXT,                 -- ç³»ç»Ÿæç¤ºè¯
    tool_dependencies TEXT[],           -- å·¥å…·ä¾èµ–åˆ—è¡¨
    
    rag_enabled BOOLEAN DEFAULT FALSE,  -- RAGåŠŸèƒ½å¼€å…³
    
    -- ç‰ˆæœ¬ç®¡ç†
    changelog TEXT,                     -- ç‰ˆæœ¬å˜æ›´è¯´æ˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- çº¦æŸï¼šworkflow_definitionå’Œworkflow_template_idäºŒé€‰ä¸€
    CONSTRAINT check_workflow_source CHECK (
        (workflow_definition IS NOT NULL AND workflow_template_id IS NULL) OR
        (workflow_definition IS NULL AND workflow_template_id IS NOT NULL)
    ),
    CONSTRAINT unique_current_version UNIQUE (agent_id) WHERE is_current = TRUE
);
```

#### 3.1.4 ç”¨æˆ·Agentä½¿ç”¨è®°å½•è¡¨
```sql
CREATE TABLE agent_usage (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    agent_id UUID REFERENCES agents(id),
    first_used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    usage_count INTEGER DEFAULT 1,
    UNIQUE(user_id, agent_id)
);
```

### 3.2 èŠå¤©ç›¸å…³è¡¨è®¾è®¡

#### 3.2.1 èŠå¤©ä¼šè¯è¡¨ï¼ˆç‰ˆæœ¬é”å®šä¼˜åŒ–ç‰ˆï¼‰
```sql
CREATE TABLE chats (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    agent_id UUID REFERENCES agents(id),
    agent_version_id UUID REFERENCES agent_versions(id), -- é”å®šä½¿ç”¨çš„Agentç‰ˆæœ¬
    title VARCHAR(255),
    context JSONB,
    status VARCHAR(50) DEFAULT 'active', -- 'active', 'archived', 'deleted'
    expires_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.2.2 èŠå¤©æ¶ˆæ¯è¡¨ï¼ˆé›†æˆLangGraphå·¥ä½œæµæ”¯æŒï¼‰
```sql
CREATE TABLE chat_messages (
    id UUID PRIMARY KEY,
    chat_id UUID REFERENCES chats(id),
    parent_message_id UUID REFERENCES chat_messages(id),
    role VARCHAR(50), -- 'user' or 'assistant'
    content TEXT,
    status VARCHAR(50) DEFAULT 'sent', -- 'sending', 'sent', 'failed', 'deleted'
    metadata JSONB,
    
    -- ğŸš€ LangGraphå·¥ä½œæµé›†æˆå­—æ®µ
    workflow_execution_id UUID,                     -- å…³è”å·¥ä½œæµæ‰§è¡ŒID
    workflow_node_name VARCHAR(128),                -- äº§ç”Ÿæ­¤æ¶ˆæ¯çš„å·¥ä½œæµèŠ‚ç‚¹
    workflow_status VARCHAR(32) DEFAULT 'completed', -- å·¥ä½œæµçŠ¶æ€
    message_type VARCHAR(32) DEFAULT 'text',        -- æ¶ˆæ¯ç±»å‹ï¼štext, progress, error, system
    is_intermediate BOOLEAN DEFAULT FALSE,          -- æ˜¯å¦ä¸ºä¸­é—´è¿›åº¦æ¶ˆæ¯ï¼ˆå¯æ¸…ç†ï¼‰
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.2.3 å·¥ä½œæµæ‰§è¡Œè·Ÿè¸ªè¡¨
```sql
CREATE TABLE workflow_executions (
    id UUID PRIMARY KEY,
    chat_id UUID NOT NULL REFERENCES chats(id) ON DELETE CASCADE,
    message_id UUID REFERENCES chat_messages(id) ON DELETE CASCADE,
    agent_version_id UUID NOT NULL REFERENCES agent_versions(id),
    
    -- LangGraphæ£€æŸ¥ç‚¹é›†æˆ
    thread_id VARCHAR(255) NOT NULL,              -- å¯¹åº”LangGraphçš„thread_id
    checkpoint_id VARCHAR(255),                   -- å½“å‰æ£€æŸ¥ç‚¹ID
    checkpointer_schema VARCHAR(64) DEFAULT 'langgraph',
    
    -- æ‰§è¡ŒçŠ¶æ€
    status VARCHAR(32) NOT NULL DEFAULT 'running',
    current_node VARCHAR(128),                     -- å½“å‰æ‰§è¡Œçš„å·¥ä½œæµèŠ‚ç‚¹
    
    -- æ‰§è¡Œç»“æœå’Œé”™è¯¯
    final_result JSONB,                           -- æœ€ç»ˆæ‰§è¡Œç»“æœ
    error_info JSONB,                             -- é”™è¯¯è¯¦ç»†ä¿¡æ¯
    
    -- æ€§èƒ½ç»Ÿè®¡
    total_nodes INTEGER DEFAULT 0,
    completed_nodes INTEGER DEFAULT 0,
    failed_nodes INTEGER DEFAULT 0,
    
    -- æ—¶é—´æˆ³
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    paused_at TIMESTAMP,                          -- æš‚åœæ—¶é—´ï¼ˆäººå·¥å¹²é¢„ï¼‰
    
    UNIQUE (chat_id, thread_id)
);
```

### 3.3 ç»Ÿä¸€æœåŠ¡é…ç½®ç³»ç»Ÿ

#### 3.3.1 æœåŠ¡ä¾›åº”å•†è¡¨ï¼ˆæ‰©å±•ç°æœ‰providersè¡¨ï¼‰
```sql
CREATE TABLE providers (
    provider_id INTEGER PRIMARY KEY AUTOINCREMENT,
    provider_name VARCHAR(64) NOT NULL,
    display_name VARCHAR(128) NOT NULL,
    service_type VARCHAR(50) NOT NULL DEFAULT 'llm',  -- æœåŠ¡ç±»å‹
    description TEXT,
    
    -- é…ç½®é¡¹å®šä¹‰ï¼ˆåŸºäºä¾èµ–å€’ç½®åŸåˆ™ï¼‰
    config_schema JSONB NOT NULL,                   -- é…ç½®é¡¹JSON Schemaå®šä¹‰
    auth_type VARCHAR(50) DEFAULT 'api_key',        -- è®¤è¯ç±»å‹ï¼šapi_key, oauth, basicç­‰
    
    is_active BOOLEAN NOT NULL DEFAULT 1,
    created_by VARCHAR(64) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by VARCHAR(64) NOT NULL,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    is_delete BOOLEAN NOT NULL DEFAULT 0
);
-- æœåŠ¡ç±»å‹ï¼š'llm', 'search', 'code_executor', 'database', 'storage', 'api_service', 'vector_db'

-- é…ç½®schemaç¤ºä¾‹ï¼ˆåŸºäºJSON Schemaæ ¼å¼ï¼‰ï¼š
-- OpenAI: {"type":"object","properties":{"api_key":{"type":"string","encrypted":true,"required":true},"model":{"type":"string","enum":["gpt-4","gpt-3.5-turbo"]},"temperature":{"type":"number","min":0,"max":2}}}
-- PostgreSQL: {"type":"object","properties":{"host":{"type":"string","required":true},"port":{"type":"integer","default":5432},"username":{"type":"string","required":true},"password":{"type":"string","encrypted":true,"required":true},"database":{"type":"string","required":true}}}
```

#### 3.3.2 ç»Ÿä¸€æœåŠ¡é…ç½®è¡¨
```sql
CREATE TABLE service_configs (
    config_id INTEGER PRIMARY KEY AUTOINCREMENT,
    provider_id INTEGER NOT NULL,
    service_name VARCHAR(128) NOT NULL,
    service_display_name VARCHAR(128) NOT NULL,
    
    -- é…ç½®æ•°æ®ï¼ˆåŸºäºproviderçš„config_schemaï¼‰
    config_data JSONB NOT NULL,                 -- æ ¹æ®provider.config_schemaå¡«å……çš„é…ç½®æ•°æ®
    credentials TEXT,                           -- åŠ å¯†è®¤è¯ä¿¡æ¯
    
    -- é…ç½®éªŒè¯çŠ¶æ€
    validation_status VARCHAR(20) DEFAULT 'pending', -- pending, valid, invalid
    validation_errors JSONB,                    -- éªŒè¯é”™è¯¯è¯¦æƒ…
    last_validated_at DATETIME,
    
    pricing_config JSONB,                       -- å®šä»·é…ç½®
    limits_config JSONB,                        -- ä½¿ç”¨é™åˆ¶é…ç½®
    is_active BOOLEAN NOT NULL DEFAULT 1,
    created_by VARCHAR(64) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by VARCHAR(64) NOT NULL,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    is_delete BOOLEAN NOT NULL DEFAULT 0,
    
    FOREIGN KEY (provider_id) REFERENCES providers(provider_id),
    UNIQUE (provider_id, service_name, is_delete)
);
```

#### 3.3.3 é…ç½®ç®¡ç†è®¾è®¡è¯´æ˜

**åŸºäºä¾èµ–å€’ç½®åŸåˆ™çš„é…ç½®ç®¡ç†æ¶æ„ï¼š**

1. **providersè¡¨å®šä¹‰é…ç½®å¥‘çº¦**ï¼šæ¯ä¸ªprovideré€šè¿‡`config_schema`å­—æ®µå®šä¹‰å…¶éœ€è¦çš„é…ç½®é¡¹ã€ç±»å‹ã€éªŒè¯è§„åˆ™ç­‰
2. **service_configsè¡¨æä¾›é…ç½®å®ç°**ï¼šæ ¹æ®providerçš„schemaæä¾›å…·ä½“çš„é…ç½®å€¼
3. **è‡ªåŠ¨éªŒè¯å’ŒåŠ å¯†**ï¼šç³»ç»Ÿæ ¹æ®schemaè‡ªåŠ¨éªŒè¯é…ç½®åˆæ³•æ€§ï¼Œå¹¶å¯¹æ ‡è®°ä¸º`encrypted`çš„å­—æ®µè¿›è¡ŒåŠ å¯†
4. **åŠ¨æ€UIç”Ÿæˆ**ï¼šå‰ç«¯å¯æ ¹æ®schemaåŠ¨æ€ç”Ÿæˆé…ç½®è¡¨å•

**é…ç½®ä½¿ç”¨æµç¨‹ï¼š**
- Agentåˆ›å»ºæ—¶é€‰æ‹©æœåŠ¡ç±»å‹å’Œprovider
- ç³»ç»Ÿæ ¹æ®provider.config_schemaç”Ÿæˆé…ç½®è¡¨å•
- ç”¨æˆ·å¡«å†™é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨éªŒè¯å’ŒåŠ å¯†
- Agentæ‰§è¡Œæ—¶æ ¹æ®é…ç½®IDè·å–è§£å¯†åçš„é…ç½®

### 3.4 Workflowæ¨¡æ¿åŒ–ç›¸å…³è¡¨è®¾è®¡

#### 3.4.1 Nodeç±»å‹å®šä¹‰è¡¨
```sql
CREATE TABLE node_types (
    id UUID PRIMARY KEY,
    type_name VARCHAR(64) NOT NULL UNIQUE,  -- å¦‚ï¼šllm_processor, search_processor
    display_name VARCHAR(128) NOT NULL,     -- æ˜¾ç¤ºåç§°
    description TEXT,                       -- ç±»å‹æè¿°
    
    -- éªŒè¯å’Œé…ç½®
    input_schema JSONB NOT NULL,           -- è¾“å…¥å‚æ•°JSON Schema
    output_schema JSONB NOT NULL,          -- è¾“å‡ºå‚æ•°JSON Schema
    required_services TEXT[] NOT NULL,     -- å¿…éœ€çš„æœåŠ¡ç±»å‹
    default_config JSONB,                  -- é»˜è®¤é…ç½®
    
    -- åˆ†ç±»å’Œæ ‡ç­¾
    category VARCHAR(50),                  -- åˆ†ç±»ï¼šprocessing, io, control, integration
    tags TEXT[],                          -- æ ‡ç­¾
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.4.2 Workflowæ¨¡æ¿è¡¨
```sql
CREATE TABLE workflow_templates (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    display_name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(100),                 -- åˆ†ç±»ï¼šä»£ç å®¡æŸ¥ã€å†…å®¹ç”Ÿæˆã€æ•°æ®åˆ†æç­‰
    
    -- æ¨¡æ¿å®šä¹‰
    template_definition JSONB NOT NULL,   -- æ ‡å‡†åŒ–çš„workflowç»“æ„
    parameter_schema JSONB,               -- å‚æ•°åŒ–é…ç½®schema
    
    -- ä½¿ç”¨ç»Ÿè®¡
    usage_count INTEGER DEFAULT 0,
    average_rating DECIMAL(3,2),
    
    -- ç‰ˆæœ¬å’ŒçŠ¶æ€
    version VARCHAR(50) DEFAULT '1.0.0',
    status VARCHAR(50) DEFAULT 'active',  -- active, deprecated, draft
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3.4.3 æ¨¡æ¿ä¸­çš„Nodeå®šä¹‰è¡¨
```sql
CREATE TABLE workflow_template_nodes (
    id UUID PRIMARY KEY,
    template_id UUID REFERENCES workflow_templates(id) ON DELETE CASCADE,
    node_name VARCHAR(128) NOT NULL,
    node_type_id UUID REFERENCES node_types(id),
    
    -- Nodeé…ç½®
    node_config JSONB NOT NULL,           -- èŠ‚ç‚¹å…·ä½“é…ç½®
    position_config JSONB,               -- UIä½ç½®ä¿¡æ¯
    
    -- å…³ç³»å®šä¹‰
    parent_nodes TEXT[],                  -- çˆ¶èŠ‚ç‚¹åˆ—è¡¨
    child_nodes TEXT[],                   -- å­èŠ‚ç‚¹åˆ—è¡¨
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(template_id, node_name)
);
```

#### 3.4.4 æ¨¡æ¿è¾¹å®šä¹‰è¡¨ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
```sql
CREATE TABLE workflow_template_edges (
    id UUID PRIMARY KEY,
    template_id UUID REFERENCES workflow_templates(id) ON DELETE CASCADE,
    
    -- è¾¹çš„åŸºæœ¬ä¿¡æ¯
    from_node VARCHAR(128) NOT NULL,
    to_node VARCHAR(128),                    -- NULLè¡¨ç¤ºåŠ¨æ€ç›®æ ‡
    edge_type VARCHAR(50) DEFAULT 'normal',  -- normal, conditional, fanout
    
    -- æ¡ä»¶è¾¹é…ç½®
    condition_function TEXT,                 -- æ¡ä»¶å‡½æ•°åæˆ–è¡¨è¾¾å¼
    condition_mapping JSONB,                 -- æ¡ä»¶åˆ°ç›®æ ‡çš„æ˜ å°„
    -- ä¾‹å¦‚ï¼š{"true": "node_b", "false": "node_c"}
    
    -- æ‰‡å‡ºè¾¹é…ç½®  
    fanout_targets TEXT[],                   -- å¹¶è¡Œæ‰§è¡Œçš„ç›®æ ‡èŠ‚ç‚¹åˆ—è¡¨
    fanout_condition JSONB,                  -- æ‰‡å‡ºæ¡ä»¶é€»è¾‘
    
    -- æ‰§è¡Œç­–ç•¥
    execution_order INTEGER DEFAULT 0,
    timeout_seconds INTEGER,
    retry_policy JSONB,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- çº¦æŸ
    FOREIGN KEY (template_id, from_node) REFERENCES workflow_template_nodes(template_id, node_name),
    
    -- æ ¹æ®è¾¹ç±»å‹çš„çº¦æŸ
    CHECK (
        (edge_type = 'normal' AND to_node IS NOT NULL AND condition_function IS NULL) OR
        (edge_type = 'conditional' AND condition_function IS NOT NULL) OR  
        (edge_type = 'fanout' AND fanout_targets IS NOT NULL)
    )
);
```

### 3.5 MCPå·¥å…·ç›¸å…³è¡¨è®¾è®¡

#### 3.5.1 MCPå·¥å…·æ³¨å†Œè¡¨
```sql
CREATE TABLE mcp_tools (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    version VARCHAR(50),
    description TEXT,
    tool_type VARCHAR(50) NOT NULL,                 -- å·¥å…·ç±»å‹ï¼šhttp_api, code_tool, database, system
    manifest JSONB NOT NULL,                        -- å·¥å…·æ¥å£æ¸…å•å’Œé…ç½®
    
    server_endpoint VARCHAR(512),                   -- MCPæœåŠ¡å™¨ç«¯ç‚¹
    topic_server_id VARCHAR(255),                   -- æ‰€å±TopicæœåŠ¡å™¨ID
    
    status VARCHAR(50) DEFAULT 'active',            -- 'active', 'inactive', 'deprecated'
    tags TEXT[],                                     -- å·¥å…·æ ‡ç­¾æ•°ç»„
    
    -- FastMCPé›†æˆå­—æ®µ
    is_streaming_supported BOOLEAN DEFAULT FALSE,   -- æ˜¯å¦æ”¯æŒæµå¼è°ƒç”¨
    max_execution_time INTEGER DEFAULT 300,         -- æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
    resource_requirements JSONB,                    -- èµ„æºéœ€æ±‚é…ç½®
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (topic_server_id) REFERENCES mcp_topic_servers(server_id) ON DELETE CASCADE,
    UNIQUE(name, topic_server_id)
);
```

#### 3.5.2 MCPæœåŠ¡å™¨çŠ¶æ€è¡¨
```sql
CREATE TABLE mcp_topic_servers (
    id UUID PRIMARY KEY,
    server_id VARCHAR(255) NOT NULL UNIQUE,         -- TopicæœåŠ¡å™¨æ ‡è¯†
    name VARCHAR(255) NOT NULL,
    description TEXT,
    
    agent_version_id UUID,                          -- å…³è”çš„Agentç‰ˆæœ¬
    
    -- æœåŠ¡é…ç½®
    endpoint_url VARCHAR(512) NOT NULL,
    status VARCHAR(50) DEFAULT 'active',
    tool_count INTEGER DEFAULT 0,
    
    -- æ€§èƒ½ç»Ÿè®¡
    total_calls INTEGER DEFAULT 0,
    success_calls INTEGER DEFAULT 0,
    average_response_time DECIMAL(10,3),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_health_check TIMESTAMP,
    
    FOREIGN KEY (agent_version_id) REFERENCES agent_versions(id) ON DELETE CASCADE
);
```

### 3.5 æ•°æ®åº“è§†å›¾å’Œç´¢å¼•ä¼˜åŒ–

#### 3.5.1 å½“å‰Agenté…ç½®è§†å›¾
```sql
CREATE VIEW current_agent_configs AS
SELECT 
    -- AgentåŸºç¡€ä¿¡æ¯
    a.id, a.name, a.description, a.developer_id, a.category_id, a.tags,
    a.status, a.download_count, a.average_rating, a.published_at,
    a.created_at as agent_created_at, a.updated_at as agent_updated_at,
    
    -- Agentç‰ˆæœ¬ä¿¡æ¯
    av.id as version_id, av.version, av.workflow_definition, av.system_prompt,
    av.tool_dependencies, av.service_dependencies, av.rag_enabled,
    av.model_params_override, av.changelog, av.created_at as version_created_at
FROM agents a
JOIN agent_versions av ON a.id = av.agent_id 
WHERE av.is_current = TRUE;
```

#### 3.5.2 æ ¸å¿ƒç´¢å¼•è®¾è®¡
```sql
-- Agentç›¸å…³ç´¢å¼•
CREATE INDEX idx_agents_category ON agents(category_id);
CREATE INDEX idx_agents_status ON agents(status);
CREATE INDEX idx_agents_developer ON agents(developer_id);
CREATE INDEX idx_agents_tags ON agents USING gin(tags);
CREATE INDEX idx_agent_versions_agent ON agent_versions(agent_id);
CREATE INDEX idx_agent_versions_current ON agent_versions(agent_id) WHERE is_current = TRUE;

-- èŠå¤©ç›¸å…³ç´¢å¼•
CREATE INDEX idx_chats_user ON chats(user_id);
CREATE INDEX idx_chats_agent_version ON chats(agent_version_id);
CREATE INDEX idx_chat_messages_chat ON chat_messages(chat_id);
CREATE INDEX idx_chat_messages_workflow ON chat_messages(workflow_execution_id);

-- å·¥ä½œæµç›¸å…³ç´¢å¼•
CREATE INDEX idx_workflow_executions_chat ON workflow_executions(chat_id);
CREATE INDEX idx_workflow_executions_status ON workflow_executions(status);
CREATE INDEX idx_workflow_executions_thread ON workflow_executions(thread_id);

-- JSONBå­—æ®µç´¢å¼•
CREATE INDEX idx_agent_versions_workflow ON agent_versions USING gin(workflow_definition);
CREATE INDEX idx_agent_versions_service_deps ON agent_versions USING gin(service_dependencies);
CREATE INDEX idx_service_configs_data ON service_configs USING gin(config_data);
```

## 4. æµç¨‹è®¾è®¡

### 4.1 Agentå¼€å‘æµç¨‹ï¼ˆæ”¯æŒå·¥ä½œæµæ¨¡æ¿ï¼‰

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant IDE as Agent IDE
    participant Template as Template System
    participant Store as AgentStore
    participant Review as Review System
    
    Dev->>IDE: åˆ›å»ºAgenté¡¹ç›®
    Dev->>Template: é€‰æ‹©å·¥ä½œæµæ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
    alt ä½¿ç”¨æ¨¡æ¿
        Template->>IDE: åŠ è½½æ¨¡æ¿å®šä¹‰
        IDE->>IDE: é…ç½®æ¨¡æ¿å‚æ•°
        IDE->>IDE: å®ä¾‹åŒ–å·¥ä½œæµ
    else è‡ªå®šä¹‰å·¥ä½œæµ
        IDE->>IDE: ç¼–å†™å·¥ä½œæµå®šä¹‰
    end
    IDE->>IDE: è®¾ç½®æœåŠ¡ä¾èµ–
    IDE->>IDE: èŠ‚ç‚¹ç±»å‹éªŒè¯
    Dev->>IDE: ç¼–å†™Agenté€»è¾‘
    IDE->>IDE: æ²™ç®±æµ‹è¯•
    Dev->>Store: æäº¤å‘å¸ƒç”³è¯·
    Store->>Review: è‡ªåŠ¨å®¡æ ¸ï¼ˆåŒ…å«æ¨¡æ¿å…¼å®¹æ€§ï¼‰
    Review->>Store: å®¡æ ¸é€šè¿‡
    Store->>Store: å‘å¸ƒåˆ°å•†åº—
```

### 4.2 ç”¨æˆ·ä½¿ç”¨Agentæµç¨‹ï¼ˆæ”¯æŒæ¨¡æ¿åŒ–å·¥ä½œæµï¼‰

```mermaid
sequenceDiagram
    participant User as User
    participant Web as Web UI
    participant API as Backend API
    participant Template as Template Engine
    participant LG as LangGraph
    participant MCP as MCP Tools
    
    User->>Web: é€‰æ‹©Agent
    Web->>API: åˆ›å»ºå¯¹è¯
    API->>API: é”å®šAgentç‰ˆæœ¬
    API->>Template: è§£æå·¥ä½œæµé…ç½®
    alt åŸºäºæ¨¡æ¿
        Template->>Template: åŠ è½½æ¨¡æ¿å®šä¹‰
        Template->>Template: åº”ç”¨å‚æ•°å®ä¾‹åŒ–
        Template->>LG: æ„å»ºå·¥ä½œæµå›¾
    else å†…è”å®šä¹‰
        API->>LG: ç›´æ¥æ„å»ºå·¥ä½œæµå›¾
    end
    User->>Web: å‘é€æ¶ˆæ¯
    Web->>API: è°ƒç”¨Agent
    API->>LG: æ‰§è¡Œå·¥ä½œæµ
    LG->>MCP: è°ƒç”¨å·¥å…·
    MCP->>LG: è¿”å›ç»“æœ
    LG->>API: å·¥ä½œæµå®Œæˆ
    API->>Web: è¿”å›å“åº”
    Web->>User: æ˜¾ç¤ºç»“æœ
```

### 4.3 å·¥ä½œæµæ¨¡æ¿åˆ›å»ºå’Œç®¡ç†æµç¨‹

```mermaid
sequenceDiagram
    participant Admin as Template Admin
    participant System as Template System
    participant NodeRepo as Node Types Repository
    participant Validator as Template Validator
    participant Store as Template Store
    
    Admin->>System: åˆ›å»ºæ–°æ¨¡æ¿
    Admin->>NodeRepo: é€‰æ‹©èŠ‚ç‚¹ç±»å‹
    NodeRepo->>System: è¿”å›èŠ‚ç‚¹å®šä¹‰å’ŒSchema
    Admin->>System: é…ç½®èŠ‚ç‚¹å‚æ•°å’Œå…³ç³»
    Admin->>System: å®šä¹‰è¾¹å’Œæ¡ä»¶é€»è¾‘
    System->>Validator: éªŒè¯æ¨¡æ¿å®Œæ•´æ€§
    Validator->>Validator: æ£€æŸ¥èŠ‚ç‚¹å…¼å®¹æ€§
    Validator->>Validator: éªŒè¯è¾¹çš„æœ‰æ•ˆæ€§
    Validator->>Validator: æ£€æŸ¥å‚æ•°Schema
    alt éªŒè¯é€šè¿‡
        Validator->>Store: ä¿å­˜æ¨¡æ¿
        Store->>System: è¿”å›æ¨¡æ¿ID
        System->>Admin: åˆ›å»ºæˆåŠŸ
    else éªŒè¯å¤±è´¥
        Validator->>Admin: è¿”å›é”™è¯¯ä¿¡æ¯
    end
```

### 4.4 Multi-Agentå·¥ä½œæµæ‰§è¡Œæµç¨‹

```mermaid
graph TB
    A[ç”¨æˆ·æ¶ˆæ¯] --> B[å·¥ä½œæµå¼•æ“]
    B --> C[ä»£ç åˆ†æèŠ‚ç‚¹]
    B --> D[å®‰å…¨å®¡æŸ¥èŠ‚ç‚¹]
    B --> E[æ€§èƒ½æ£€æŸ¥èŠ‚ç‚¹]
    C --> F[Webç ”ç©¶èŠ‚ç‚¹]
    D --> F
    E --> F
    F --> G[æœ€ç»ˆæ€»ç»“èŠ‚ç‚¹]
    G --> H[è¿”å›ç”¨æˆ·]
    
    C --> C1[LLMæœåŠ¡ + æ•°æ®åº“]
    D --> D1[ä¸åŒLLM + æ¼æ´åº“]
    E --> E1[ä¸“ç”¨æ¨¡å‹ + å‘é‡åº“]
    F --> F1[æœç´¢æœåŠ¡ + LLMç­›é€‰]
    G --> G1[GPT-4 + æŠ¥å‘Šæ¨¡æ¿]
```

## 5. æ¥å£è®¾è®¡

### 5.1 Agentå¼€å‘API

```python
@router.post("/agents")
async def create_agent(agent_data: AgentCreateSchema):
    """åˆ›å»ºAgent"""

@router.put("/agents/{agent_id}/workflow")
async def update_workflow(agent_id: UUID, workflow: WorkflowUpdateSchema):
    """æ›´æ–°Agentå·¥ä½œæµï¼ˆæ”¯æŒæ¨¡æ¿æˆ–å†…è”å®šä¹‰ï¼‰"""

@router.post("/agents/{agent_id}/workflow/from-template")
async def create_workflow_from_template(
    agent_id: UUID, 
    template_data: WorkflowFromTemplateSchema
):
    """åŸºäºæ¨¡æ¿åˆ›å»ºAgentå·¥ä½œæµ"""

@router.get("/agents/{agent_id}/workflow/validate")
async def validate_workflow(agent_id: UUID):
    """éªŒè¯Agentå·¥ä½œæµé…ç½®"""

@router.post("/agents/{agent_id}/test")
async def test_agent(agent_id: UUID, test_input: str):
    """æµ‹è¯•Agent"""

@router.post("/agents/{agent_id}/publish")
async def publish_agent(agent_id: UUID):
    """å‘å¸ƒAgentåˆ°å•†åº—"""
```

### 5.2 Workflowæ¨¡æ¿API

```python
@router.get("/workflow-templates")
async def search_templates(
    q: str = None, 
    category: str = None,
    node_type: str = None,
    complexity: str = None
):
    """æœç´¢å·¥ä½œæµæ¨¡æ¿"""

@router.get("/workflow-templates/{template_id}")
async def get_template_details(template_id: UUID):
    """è·å–æ¨¡æ¿è¯¦æƒ…"""

@router.post("/workflow-templates")
async def create_template(template_data: TemplateCreateSchema):
    """åˆ›å»ºå·¥ä½œæµæ¨¡æ¿"""

@router.put("/workflow-templates/{template_id}")
async def update_template(template_id: UUID, template_data: TemplateUpdateSchema):
    """æ›´æ–°å·¥ä½œæµæ¨¡æ¿"""

@router.delete("/workflow-templates/{template_id}")
async def delete_template(template_id: UUID):
    """åˆ é™¤å·¥ä½œæµæ¨¡æ¿"""

@router.post("/workflow-templates/{template_id}/validate")
async def validate_template(template_id: UUID):
    """éªŒè¯å·¥ä½œæµæ¨¡æ¿"""

@router.post("/workflow-templates/{template_id}/instantiate")
async def instantiate_template(template_id: UUID, parameters: TemplateParametersSchema):
    """å®ä¾‹åŒ–æ¨¡æ¿ä¸ºå…·ä½“å·¥ä½œæµ"""

@router.get("/workflow-templates/{template_id}/preview")
async def preview_template_instance(template_id: UUID, parameters: TemplateParametersSchema):
    """é¢„è§ˆæ¨¡æ¿å®ä¾‹åŒ–ç»“æœ"""

@router.get("/workflow-templates/{template_id}/usage-stats")
async def get_template_usage_stats(template_id: UUID):
    """è·å–æ¨¡æ¿ä½¿ç”¨ç»Ÿè®¡"""
```

### 5.3 èŠ‚ç‚¹ç±»å‹ç®¡ç†API

```python
@router.get("/node-types")
async def list_node_types(category: str = None):
    """åˆ—å‡ºå¯ç”¨çš„èŠ‚ç‚¹ç±»å‹"""

@router.get("/node-types/{type_name}")
async def get_node_type(type_name: str):
    """è·å–èŠ‚ç‚¹ç±»å‹è¯¦ç»†ä¿¡æ¯"""

@router.post("/node-types")
async def create_node_type(node_type_data: NodeTypeCreateSchema):
    """åˆ›å»ºæ–°çš„èŠ‚ç‚¹ç±»å‹"""

@router.put("/node-types/{type_name}")
async def update_node_type(type_name: str, node_type_data: NodeTypeUpdateSchema):
    """æ›´æ–°èŠ‚ç‚¹ç±»å‹å®šä¹‰"""

@router.post("/node-types/{type_name}/validate-config")
async def validate_node_config(type_name: str, config: dict):
    """éªŒè¯èŠ‚ç‚¹é…ç½®æ˜¯å¦ç¬¦åˆç±»å‹è¦æ±‚"""
```

### 5.4 AgentStore API

```python
@router.get("/store/agents")
async def search_agents(q: str, category: str = None):
    """æœç´¢Agent"""

@router.get("/store/agents/{agent_id}")
async def get_agent_details(agent_id: UUID):
    """è·å–Agentè¯¦æƒ…"""

@router.post("/store/agents/{agent_id}/install")
async def install_agent(agent_id: UUID):
    """å®‰è£…Agent"""
```

### 5.5 å¯¹è¯APIï¼ˆé›¶é…ç½®ä½“éªŒï¼‰

```python
@router.post("/chats")
async def create_chat(agent_id: UUID):
    """é›¶é…ç½®åˆ›å»ºå¯¹è¯ - è‡ªåŠ¨ä½¿ç”¨å¹³å°æœåŠ¡é…ç½®"""

@router.post("/chats/{chat_id}/messages")
async def send_message(chat_id: UUID, message: str):
    """å‘é€æ¶ˆæ¯ - è‡ªåŠ¨åº”ç”¨Agenté…ç½®å’Œå¹³å°æœåŠ¡è®¾ç½®"""

@router.get("/chats/{chat_id}/messages")
async def get_messages(chat_id: UUID):
    """è·å–å¯¹è¯å†å²"""
```

## 6. å®‰å…¨è®¾è®¡

### 6.1 æ•°æ®å®‰å…¨

- **APIå¯†é’¥åŠ å¯†å­˜å‚¨**ï¼šä½¿ç”¨å›½å¯†SM4ç®—æ³•åŠ å¯†æ‰€æœ‰APIå¯†é’¥
- **æ•°æ®ä¼ è¾“åŠ å¯†**ï¼šHTTPS/TLS 1.3åŠ å¯†ä¼ è¾“
- **æ•°æ®åº“åŠ å¯†**ï¼šæ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨
- **è®¿é—®æ§åˆ¶**ï¼šåŸºäºJWTçš„èº«ä»½è®¤è¯å’ŒRBACæƒé™æ§åˆ¶

### 6.2 ä»£ç æ‰§è¡Œå®‰å…¨

- **æ²™ç®±ç¯å¢ƒ**ï¼šAgentä»£ç åœ¨Dockerå®¹å™¨ä¸­éš”ç¦»æ‰§è¡Œ
- **èµ„æºé™åˆ¶**ï¼šå†…å­˜ã€CPUã€æ‰§è¡Œæ—¶é—´é™åˆ¶
- **ç½‘ç»œéš”ç¦»**ï¼šé™åˆ¶Agentè®¿é—®å¤–éƒ¨ç½‘ç»œ
- **ä»£ç å®¡æ ¸**ï¼šå‘å¸ƒå‰è‡ªåŠ¨å®‰å…¨æ‰«æ

### 6.3 MCPå·¥å…·å®‰å…¨

- **å·¥å…·æ²™ç®±**ï¼šç‹¬ç«‹çš„MCPæœåŠ¡å™¨ç¯å¢ƒ
- **æƒé™æ§åˆ¶**ï¼šç”¨æˆ·æˆæƒAgentä½¿ç”¨ç‰¹å®šå·¥å…·
- **è°ƒç”¨ç›‘æ§**ï¼šå®Œæ•´çš„å·¥å…·è°ƒç”¨æ—¥å¿—å’Œå®¡è®¡
- **èµ„æºé™åˆ¶**ï¼šå·¥å…·æ‰§è¡Œæ—¶é—´å’Œèµ„æºé™åˆ¶

## 7. æ€§èƒ½è®¾è®¡

### 7.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

- **ç´¢å¼•ç­–ç•¥**ï¼šä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µå»ºç«‹åˆé€‚ç´¢å¼•
- **åˆ†åŒºç­–ç•¥**ï¼šå¯¹å¤§æ•°æ®é‡è¡¨è¿›è¡Œæ—¶é—´åˆ†åŒº
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨è§†å›¾ç®€åŒ–å¤æ‚æŸ¥è¯¢
- **è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

### 7.2 ç¼“å­˜ç­–ç•¥

- **Redisç¼“å­˜**ï¼šAgenté…ç½®ã€ç”¨æˆ·ä¼šè¯ç¼“å­˜
- **åº”ç”¨ç¼“å­˜**ï¼šçƒ­é—¨Agentå’Œæœç´¢ç»“æœç¼“å­˜
- **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºå’ŒAPIå“åº”ç¼“å­˜

### 7.3 å¹¶å‘å¤„ç†

- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨async/awaitå¤„ç†å¹¶å‘è¯·æ±‚
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šCeleryå¤„ç†é•¿æ—¶é—´ä»»åŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•å’Œè´Ÿè½½åˆ†å‘

## 8. ç›‘æ§ä¸è¿ç»´

### 8.1 ç³»ç»Ÿç›‘æ§

- **åº”ç”¨ç›‘æ§**ï¼šAPMå·¥å…·ç›‘æ§åº”ç”¨æ€§èƒ½
- **åŸºç¡€è®¾æ–½ç›‘æ§**ï¼šæœåŠ¡å™¨èµ„æºç›‘æ§
- **ä¸šåŠ¡ç›‘æ§**ï¼šAgentä½¿ç”¨ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§

### 8.2 æ—¥å¿—ç®¡ç†

- **ç»“æ„åŒ–æ—¥å¿—**ï¼šä½¿ç”¨loguruè®°å½•ç»“æ„åŒ–æ—¥å¿—
- **æ—¥å¿—èšåˆ**ï¼šELK Stackæ—¥å¿—æ”¶é›†å’Œåˆ†æ
- **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´çš„ç”¨æˆ·æ“ä½œå®¡è®¡è®°å½•

### 8.3 å‘Šè­¦æœºåˆ¶

- **å®æ—¶å‘Šè­¦**ï¼šç³»ç»Ÿå¼‚å¸¸å®æ—¶å‘Šè­¦
- **æ€§èƒ½å‘Šè­¦**ï¼šæ€§èƒ½æŒ‡æ ‡é˜ˆå€¼å‘Šè­¦
- **ä¸šåŠ¡å‘Šè­¦**ï¼šä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸å‘Šè­¦

## 9. éƒ¨ç½²æ¶æ„

### 9.1 å®¹å™¨åŒ–éƒ¨ç½²

- **Dockerå®¹å™¨**ï¼šæ‰€æœ‰æœåŠ¡å®¹å™¨åŒ–éƒ¨ç½²
- **Kubernetesç¼–æ’**ï¼šä½¿ç”¨K8sç®¡ç†å®¹å™¨ç¼–æ’
- **å¾®æœåŠ¡æ‹†åˆ†**ï¼šæŒ‰æ¨¡å—æ‹†åˆ†ä¸ºç‹¬ç«‹æœåŠ¡

### 9.2 CI/CDæµç¨‹

- **ä»£ç ç®¡ç†**ï¼šGitç‰ˆæœ¬æ§åˆ¶å’Œåˆ†æ”¯ç®¡ç†
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•è‡ªåŠ¨åŒ–
- **è‡ªåŠ¨éƒ¨ç½²**ï¼šGitOpså·¥ä½œæµè‡ªåŠ¨éƒ¨ç½²

### 9.3 ç¯å¢ƒç®¡ç†

- **å¼€å‘ç¯å¢ƒ**ï¼šæœ¬åœ°å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- **æµ‹è¯•ç¯å¢ƒ**ï¼šé›†æˆæµ‹è¯•å’Œç”¨æˆ·éªŒæ”¶æµ‹è¯•
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒ